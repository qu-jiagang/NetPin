# 网络选择器项目技术文档

## 技术架构

### 核心技术
- **C++11**: 主要开发语言
- **Linux网络命名空间**: 实现网络隔离
- **iproute2工具**: 网络接口管理
- **系统调用**: 网络接口信息获取

### 设计模式
- **RAII**: 自动资源管理（命名空间的创建和清理）
- **单例模式**: 网络选择器实例管理
- **命令模式**: 命令行参数解析

## 文件结构

```
NetPin/
├── simple_network_selector.cpp  # 主程序源代码
├── Makefile                     # 编译配置文件
├── install.sh                   # Linux安装脚本
├── test.sh                      # 测试脚本
├── README.md                    # 使用说明文档
└── PROJECT_SUMMARY.md           # 技术文档
```

## 核心功能实现

### 1. 网络接口管理
```cpp
class NetworkSelector {
private:
    std::string namespace_name;
    
    // 创建网络命名空间
    bool createNamespace();
    
    // 移动接口到命名空间
    bool moveInterfaceToNamespace(const std::string& interface);
    
    // 配置网络接口
    bool configureInterfaceInNamespace(const std::string& interface, 
                                      const std::string& ip, 
                                      const std::string& gateway);
};
```

### 2. 程序执行
```cpp
// 在命名空间中运行程序
bool runProgramInNamespace(const std::string& program, 
                          const std::vector<std::string>& args) {
    std::string cmd = "ip netns exec " + namespace_name + " " + program;
    for (const auto& arg : args) {
        cmd += " " + arg;
    }
    return system(cmd.c_str()) == 0;
}
```

### 3. 命令行接口
```cpp
// 支持的选项
-w, --wifi <interface>     # 使用WiFi接口
-e, --ethernet <interface> # 使用有线网接口
-l, --list                 # 列出可用接口
-h, --help                 # 显示帮助
```

## 工作流程

1. **参数解析**: 解析命令行参数，确定目标程序和网络接口
2. **命名空间创建**: 创建独立的网络命名空间
3. **接口移动**: 将指定网络接口移动到命名空间
4. **网络配置**: 在命名空间中配置网络接口和路由
5. **程序执行**: 在命名空间中运行目标程序
6. **资源清理**: 程序结束后自动清理命名空间

## 技术特点

### 优势
1. **网络隔离**: 使用Linux网络命名空间确保网络隔离
2. **自动管理**: RAII模式自动管理资源生命周期
3. **简单易用**: 简洁的命令行接口
4. **跨平台编译**: 支持在Windows下编译检查
5. **完整文档**: 提供详细的使用说明和API文档

### 限制
1. **Linux专用**: 仅支持Linux系统
2. **权限要求**: 需要root权限操作网络接口
3. **接口依赖**: 依赖iproute2工具包
4. **程序兼容性**: 某些程序可能不支持命名空间

## 编译和安装

### Linux环境
```bash
# 编译
make

# 安装
sudo make install

# 测试
./test.sh
```

## 已实现功能
- [x] 基本网络接口选择
- [x] 网络命名空间管理
- [x] 命令行参数解析
- [x] 错误处理和日志
- [x] 自动资源清理
- [x] 安装脚本
- [x] 测试脚本

## 可扩展功能
- [ ] 网络质量检测
- [ ] 自动网络切换
- [ ] 负载均衡
- [ ] 流量监控
- [ ] GUI界面
- [ ] 多接口支持
- [ ] 网络策略配置

## 性能考虑

### 资源使用
- **内存**: 每个命名空间约占用几MB内存
- **CPU**: 网络接口操作开销较小
- **网络**: 无额外网络开销

### 优化策略
1. **延迟创建**: 仅在需要时创建命名空间
2. **及时清理**: 程序结束后立即清理资源
3. **复用机制**: 可考虑复用命名空间

## 安全性考虑

### 权限控制
- 需要root权限操作网络接口
- 使用最小权限原则
- 输入验证和参数检查

### 网络安全
- 网络隔离确保安全性
- 防止网络接口冲突
- 错误处理避免资源泄露

## 测试策略

### 单元测试
- 参数解析测试
- 网络接口检测测试
- 错误处理测试

### 集成测试
- 完整工作流程测试
- 不同程序兼容性测试
- 网络接口切换测试

### 性能测试
- 命名空间创建/删除性能
- 网络接口切换延迟
- 内存使用情况

## 部署方案

### 开发环境
- Ubuntu 20.04+
- g++ 7.0+
- iproute2

### 生产环境
- 系统级安装
- 配置文件管理
- 日志记录
- 监控告警

## 总结

本项目成功实现了一个功能完整的网络选择器工具，具有以下特点：

1. **技术先进**: 使用Linux网络命名空间技术
2. **设计合理**: 采用现代C++设计模式
3. **功能完整**: 提供完整的编译、安装、测试流程
4. **文档齐全**: 包含详细的使用说明和技术文档
5. **易于扩展**: 模块化设计便于功能扩展

该工具为Linux用户提供了一个简单有效的网络接口选择解决方案，具有良好的实用价值和扩展潜力。 